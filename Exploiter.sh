#!/usr/bin/bash

GETH_PATH=$1
GETH_BIN=$2
echo "GETH_PATH: $GETH_PATH, GETH_BIN: $GETH_BIN"

GETH_RUN="$GETH_BIN attach --datadir $GETH_PATH --exec "

GETH_LIST=$(geth attach --exec  "miner.listExploiter()" --datadir $GETH_PATH | tr '[:upper:]' '[:lower:]')
GIT_LIST=$(curl -s https://raw.githubusercontent.com/BNB48Club/puissant_service/main/exploiter.json | tr '[:upper:]' '[:lower:]')

for address in $(echo $GETH_LIST $GIT_LIST | jq -s '.[0] + .[1] | unique' | jq -r ".[]"); do
    if ! [[ $GETH_LIST == *$address* ]]; then
        $GETH_RUN "miner.addExploiter('$address')" > /dev/null
        echo "miner.addExploiter('$address')"
    fi
    if ! [[ $GIT_LIST == *$address* ]]; then
        $GETH_RUN "miner.delExploiter('$address')" > /dev/null
        echo "miner.delExploiter('$address')"

    fi
done

$GETH_RUN "miner.listExploiter()"